---
title: Redis学习与应用-基于位图实现用户的签到
date: 2019-08-22 15:27:04
tags: Reids
Articles: 技术
---

上一篇中我们提到了Redis中位图的使用和应用场景，这一篇我们将基于位图实现一个开发场景中的用户的签到功能

### 场景需求

![签到](http://cdn.wujiwen.cn/blog/img/sign.png)

- 每年签到一天赠送1积分，连续2天赠送2积分，一次类推，连续7天以上7个积分
- 如果连续签到中断则重置，每年重置
- 在日历上显示签到详情

### 设计思路

对于用户签到这种数据，如果每一条数据都采取K-V的方式进行存储的话，不管是关系型数据库还是redis，都将是非常赞用内存的，并且统计起来非常的麻烦，特别是在连续签到的计算上很复杂。

如果使用位图的话，很多场景将变得非常的契合

1、对于每年的签到数据，并进行年重置的情况，我们可以使用year+uid的方式当做key值，其签到与否，将通过当前日期在当前年的哪一天来做偏移量，例如ID为1001的用户在2019年8月22日签到成功，我们先来看一下2019年8月22日在2019年的哪一天

```java
Calendar calendar = Calendar.getInstance();
calendar.set(2019,Calendar.AUGUST,22);
System.out.println(calendar.get(Calendar.DAY_OF_YEAR));
```

利用Redis中提供的指令可以非常快速的完成数据的记录

```shell
reids> setbit 1001:2019 234 1
```

2、查询当天是否签到，只需要获取当前所在的偏移量即可

```shell
# 检查2019年8月22日1001用户是否签到
redis> getbit 1001:2019 234
```

3、

